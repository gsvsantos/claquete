<div class="main">
  <div class="content" *transloco="let t">
    <gs-buttons
      class="btn-back"
      [buttonType]="buttonType.Link"
      [text]="t('common.buttons.back')"
      bootstrapIcon="bi-chevron-double-left"
      color="#41C8D5"
      textColor="#FFFFFF"
      hoverColor="#12AFC0"
      activeColor="#29BBCA"
      link="/main-menu"
      [target]="targetType.NewTab"
      [variant]="variantType.Outline"
    ></gs-buttons>
    @if (mediaDetails$ | async; as mediaDetails) {
      <div class="card">
        <img
          class="poster"
          [src]="'https://image.tmdb.org/t/p/original/' + mediaDetails.poster_path"
          [alt]="mediaDetails.title ?? mediaDetails.name"
          loading="lazy"
        />
        <div class="text">
          <h1 class="title">
            {{ mediaDetails.title ?? mediaDetails.name }}

            <gs-buttons
              class="fav-btn"
              [buttonType]="buttonType.Default"
              text=""
              buttonHtmlType="button"
              [variant]="mediaDetails.favorite ? variantType.Solid : variantType.Outline"
              [bootstrapIcon]="mediaDetails.favorite ? 'bi-heart-fill' : 'bi-heart'"
              buttonId="fav-btn"
              color="#ff5a79"
              [textColor]="mediaDetails.favorite ? '#fff' : ''"
              (activated)="onToggleFavorite(mediaDetails)"
            >
            </gs-buttons>
          </h1>
          <p class="overview">
            {{ mediaDetails.overview || t('media-details.fallback.overview-not-available') }}
          </p>
          <div class="infos">
            <div class="vote-average">
              <i class="bi bi-star-fill"></i>
              <span>{{ mediaDetails.vote_average | tmdbPercent }}</span>
            </div>

            @if (mediaDetails.vote_count !== undefined) {
              <div class="vote-count">
                <span>{{
                  t('media-details.format.vote-count', { count: mediaDetails.vote_count })
                }}</span>
              </div>
            }

            @if (mediaDetails.release_date || mediaDetails.first_air_date) {
              <div class="release-date">
                <span>{{
                  mediaDetails.release_date ?? mediaDetails.first_air_date
                    | date: t('media-details.format.release-date')
                }}</span>
              </div>
            }
            @if (mediaDetails.runtime) {
              <div class="runtime">
                <span>{{
                  t('media-details.format.runtime-minutes', { minutes: mediaDetails.runtime })
                }}</span>
              </div>
            } @else if (mediaDetails.episode_run_time?.length) {
              <div class="runtime">
                <span>{{
                  t('media-details.format.runtime-minutes-per-episode', {
                    minutes: mediaDetails?.episode_run_time?.[0],
                  })
                }}</span>
              </div>
            }
          </div>
          @if (mediaDetails.genres.length) {
            <ul class="genres">
              @for (g of mediaDetails.genres; track g.id) {
                <li class="genre-chip">{{ g.name }}</li>
              }
            </ul>
          }
          <h2 class="section-title">{{ t('media-details.section-title.cast') }}</h2>
          @if (topCast$ | async; as topCast) {
            @if (topCast.length) {
              <ul class="people-grid">
                @for (c of topCast; track c.id) {
                  <li class="person">
                    @if (c.profile_path) {
                      <img
                        class="person-photo"
                        [src]="'https://image.tmdb.org/t/p/w185' + c.profile_path"
                        [alt]="c.name"
                        loading="lazy"
                      />
                    } @else {
                      <div class="person-photo fallback" aria-hidden="true"></div>
                    }
                    <div class="person-text">
                      <p class="person-name">{{ c.name }}</p>
                      <p class="person-role">{{ c.character }}</p>
                    </div>
                  </li>
                }
              </ul>
            } @else {
              <p class="empty">{{ t('media-details.empty.cast-not-found') }}</p>
            }
          }
          <h2 class="section-title">{{ t('media-details.section-title.crew') }}</h2>
          @if (mainCrew$ | async; as mainCrew) {
            @if (mainCrew.length) {
              <ul class="crew-list">
                @for (m of mainCrew; track m.id) {
                  <li class="crew-item">
                    <span class="crew-name">{{ m.name }}</span>
                    <span class="crew-job">{{ m.job }}</span>
                  </li>
                }
              </ul>
            } @else {
              <p class="empty">{{ t('media-details.empty.crew-not-found') }}</p>
            }
          }
          <h2 class="section-title">{{ t('media-details.section-title.videos') }}</h2>
          @if (videosTrailerClip$ | async; as videos) {
            @if (videos.length) {
              <div class="videos-grid">
                @for (video of videos; track video.id) {
                  <a
                    class="video-thumb"
                    [href]="'https://www.youtube.com/watch?v=' + video.key"
                    target="_blank"
                    rel="noopener"
                    [title]="video.name"
                  >
                    <img
                      [src]="'https://img.youtube.com/vi/' + video.key + '/hqdefault.jpg'"
                      [alt]="video.name"
                      loading="lazy"
                    />
                    <span class="video-label">{{ video.type }}</span>
                  </a>
                }
              </div>
            } @else {
              <p class="empty">{{ t('media-details.empty.videos-not-found') }}</p>
            }
          }
        </div>
      </div>
    } @else {
      <p class="empty required" [innerHTML]="t('common.messages.select-media-to-see-details')"></p>
    }
  </div>
</div>
